<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>ViCoWa Web Components - vicowa-button</title>
	<script>window.develop = true;</script>
    <script src="../../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../node_modules/@webcomponents/html-imports/html-imports.min.js"></script>
    <link rel="import" href="../../src/vicowa-editable-list/vicowa-editable-list.html">
	<link rel="import" href="./customer-settings/customer-settings.html">

	<style>
		body {
			font-family: sans-serif;
		}
		body[lang="en_US"] #english,
		body[lang="nl_NL"] #dutch {
			background-color: blue;
			color: white;
		}
		vicowa-editable-list {
			--vicowa-input-label-width: 150px;
			--vicowa-single-selection-width: 150px;
			white-space: nowrap;
			margin: 1em;
			padding: 1em;
			box-shadow: 3px 3px 8px grey;
		}

		[slot="header"] span {
			display: inline-block;
			position: relative;
			width: 150px;
		}
		[slot="header"] span:first-child {
			width: 110px;
		}

		#customerList2 {
			--vicowa-editable-list-button-area-width: 110px;
			--vicowa-editable-list-item-background: #eef;
			--vicowa-editable-list-item-even-background: #efe;
			--vicowa-editable-list-item-border: 1px dotted #aaa;
		}
	</style>
</head>
<body lang="en_US">
	<div id="translations">
		<button id="english">English</button>
		<button id="dutch">Nederlands</button>
	</div>
	<h2>Small list</h2>
	<vicowa-editable-list id="customerList1">
		<div slot="header"><span>Action</span><span>Name</span><span>EMail</span><span>Source</span><span>Address</span><span>Postal code</span><span>City</span><span>Province</span><span>Country Code</span></div>
	</vicowa-editable-list>
	<h2>List with lots of items requiring pagination, also enabled search on name item</h2>
	<vicowa-editable-list id="customerList2" filter><div slot="header"><span>Action</span><span>Name</span><span>EMail</span><span>Source</span><span>Address</span><span>Postal code</span><span>City</span><span>Province</span><span>Country Code</span></div></vicowa-editable-list>
	<h2>Very simple list with only one column and no edit possibility</h2>
	<vicowa-editable-list id="simpleData1" filter no-edit max-page-items="10"><div slot="header"><span>Action</span><span>Name</span></div></vicowa-editable-list>
	<script type="module">
		import translator from '../../src/utilities/translate.js';
		import { createQuickAccess } from '../../src/third_party/web-component-base-class/src/tools.js';

		const controls = createQuickAccess(document, "id");

		const data = {
			customers: [
				{
					id: 120911,
					name: "A Customer",
					email: "customer@email.com",
					channel: "website",
					address: "12 Main St.",
					postal: "M1M 1M1",
					city: "Toronto",
					province: "ON",
					country: "CA"
				},
				{
					id: 146633,
					name: "Another Customer",
					email: "customer2@email.com",
					channel: "phone",
					address: "12 Yonge St. #23",
					postal: "M2M 2M2",
					city: "Toronto",
					province: "ON",
					country: "CA"
				},
				{
					id: 171981,
					name: "A Great Customer",
					email: "customerplusplus@email.com",
					channel: "word-of-mouth",
					address: "2312 Eglinton Ave.",
					postal: "M3M 3M3",
					city: "Toronto",
					province: "ON",
					country: "CA"
				}
			]
		};

		const getData = async(p_Start, p_Count, p_Filter) => {
			return {
				items: data.customers.slice(p_Start, p_Count),
				totalItemCount: data.customers.length,
			};
		};

		const getData2 = async(p_Start, p_Count, p_Filter) => {
			const items = [];
			const totalItemCount = 1345;
			let testIndex = -1;
			const regExp = (p_Filter) ? new RegExp(p_Filter) : null;

			for (let index = 0; index < totalItemCount; index++) {
				const customer = Object.assign({}, data.customers[index % data.customers.length]);
				customer.name = `customer${index}`;
				if (!regExp || regExp.test(customer.name)) {
					testIndex++;
				}
				if (testIndex >= p_Start && items.length < p_Count) {
					items.push(customer);
					p_Start++;
				}
			}

			// simulate server retrieval delay between 0 and 1s
			return await new Promise((resolve) => {
				setTimeout(() => {
					resolve({
						items,
						totalItemCount: testIndex + 1,
					});
				}, 1000 * Math.random());
			});
		};

		controls.customerList1.onAttached = () => {
			controls.customerList1.factory = () => document.createElement('customer-settings');
			controls.customerList1.getData = getData;

			controls.customerList1.onChange = (p_Data, p_OldData, p_Modified) => {
				console.log(`current data: ${JSON.stringify(p_Data, null, 4)}`);
				console.log(`old data: ${JSON.stringify(p_OldData, null, 4)}`);
				console.log(`modified data: ${JSON.stringify(p_Modified.modifiedItems, null, 4)}`);
				console.log(`added data: ${JSON.stringify(p_Modified.newItems, null, 4)}`);
				console.log(`removed data: ${JSON.stringify(p_Modified.removedItems, null, 4)}`);
			};
			controls.customerList1.initialize();
		};

		controls.customerList2.onAttached = () => {
			controls.customerList2.factory = () => document.createElement('customer-settings');
			controls.customerList2.getData = getData2;
			controls.customerList2.onChange = (p_Data, p_OldData, p_Modified) => {
				console.log(`current data: ${JSON.stringify(p_Data, null, 4)}`);
				console.log(`old data: ${JSON.stringify(p_OldData, null, 4)}`);
				console.log(`modified data: ${JSON.stringify(p_Modified.modifiedItems, null, 4)}`);
				console.log(`added data: ${JSON.stringify(p_Modified.newItems, null, 4)}`);
				console.log(`removed data: ${JSON.stringify(p_Modified.removedItems, null, 4)}`);
			};
			controls.customerList2.initialize({
				startEdit(p_Item) { p_Item.startEdit(); },
				stopEdit(p_Item) { p_Item.stopEdit(); },
				doSave(p_Item) { return p_Item.doSave(); },
				doCancel(p_Item) { p_Item.doCancel(); },
				setItemData(p_Item, p_Data) { p_Item.data = p_Data; },
				getItemData(p_Item) { return p_Item.data; },
				isValid(p_Item) { return p_Item.valid; },
				hasData(p_Item) { return p_Item.hasData; },
				setReadyHandler(p_Item, p_Callback) { p_Item.onReady = p_Callback; },
				setChangeHandler(p_Item, p_Callback) { p_Item.onChange = p_Callback; },
			});
		};

		const getData3 = async(p_Start, p_Count, p_Filter) => {
			const items = [];
			const totalItemCount = 43;
			let testIndex = -1;
			const regExp = (p_Filter) ? new RegExp(p_Filter) : null;

			for (let index = 0; index < totalItemCount; index++) {
				const item = { name: `test item-${index}` };
				if (!regExp || regExp.test(item.name)) {
					testIndex++;
				}
				if (testIndex >= p_Start && items.length < p_Count) {
					items.push(item);
					p_Start++;
				}
			}

			// simulate server retrieval delay between 0 and 1s
			return await new Promise((resolve) => {
				setTimeout(() => {
					resolve({
						items,
						totalItemCount: testIndex + 1,
					});
				}, 1000 * Math.random());
			});
		};

		controls.simpleData1.onAttached = () => {
			controls.simpleData1.factory = () => { const element = document.createElement("vicowa-input"); element.label = "Name"; element.hideLabel = true; element.static = true; return element };
			controls.simpleData1.getData = getData3;
			controls.simpleData1.onChange = (p_Data, p_OldData, p_Modified) => {
				console.log(`current data: ${JSON.stringify(p_Data, null, 4)}`);
				console.log(`old data: ${JSON.stringify(p_OldData, null, 4)}`);
				console.log(`modified data: ${JSON.stringify(p_Modified.modifiedItems, null, 4)}`);
				console.log(`added data: ${JSON.stringify(p_Modified.newItems, null, 4)}`);
				console.log(`removed data: ${JSON.stringify(p_Modified.removedItems, null, 4)}`);
			};
			controls.simpleData1.initialize({
				data: Symbol("data"),
				startEdit(p_Item) { p_Item.hideLabel = false; p_Item.static = false; },
				stopEdit(p_Item) { p_Item.hideLabel = true; p_Item.static = true; },
				doSave(p_Item) { return p_Item.valid; },
				doCancel(p_Item) { },
				setItemData(p_Item, p_Data) { p_Item[this.data] = p_Data; p_Item.value = p_Data.name; },
				getItemData(p_Item) { p_Item[this.data] = p_Item[this.data] || { name: p_Item.value }; p_Item[this.data].name = p_Item.value; return p_Item[this.data]; },
				isValid(p_Item) { return !!p_Item.textContent; },
				hasData(p_Item) { return !!p_Item.textContent; },
				setReadyHandler(p_Item, p_Callback) { p_Callback(); },
				setChangeHandler(p_Item, p_Callback) { p_Item.onChanged = p_Callback; },
			});
		};

		// setup the translator
		translator.addTranslationLocation('../resources/translations');
		translator.addTranslationUpdatedObserver((p_Translator) => {
			document.body.setAttribute('lang', p_Translator.language);
		}, null);
		translator.language = document.body.getAttribute('lang');

		controls.english.addEventListener('click', () => { translator.language = 'en_US'; });
		controls.dutch.addEventListener('click', () => { translator.language = 'nl_NL'; });
	</script>
</body>

</html>
